var E=Object.create,g=Object.defineProperty,A=Object.getPrototypeOf,U=Object.prototype.hasOwnProperty,M=Object.getOwnPropertyNames,D=Object.getOwnPropertyDescriptor;var F=i=>g(i,"__esModule",{value:!0});var k=(i,t)=>{for(var s in t)g(i,s,{get:t[s],enumerable:!0})},C=(i,t,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of M(t))!U.call(i,e)&&e!=="default"&&g(i,e,{get:()=>t[e],enumerable:!(s=D(t,e))||s.enumerable});return i},y=i=>C(F(g(i!=null?E(A(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i);F(exports);k(exports,{default:()=>I});var n=y(require("obsidian"));var P=y(require("crypto")),m=new Uint8Array(256),c=m.length;function f(){return c>m.length-16&&(P.default.randomFillSync(m),c=0),m.slice(c,c+=16)}var r=[];for(let i=0;i<256;++i)r.push((i+256).toString(16).slice(1));function T(i,t=0){return r[i[t+0]]+r[i[t+1]]+r[i[t+2]]+r[i[t+3]]+"-"+r[i[t+4]]+r[i[t+5]]+"-"+r[i[t+6]]+r[i[t+7]]+"-"+r[i[t+8]]+r[i[t+9]]+"-"+r[i[t+10]]+r[i[t+11]]+r[i[t+12]]+r[i[t+13]]+r[i[t+14]]+r[i[t+15]]}var S=y(require("crypto")),x={randomUUID:S.default.randomUUID};function O(i,t,s){if(x.randomUUID&&!t&&!i)return x.randomUUID();i=i||{};let e=i.random||(i.rng||f)();if(e[6]=e[6]&15|64,e[8]=e[8]&63|128,t){s=s||0;for(let a=0;a<16;++a)t[s+a]=e[a];return t}return T(e)}var h=O;var _={frontmatterProperty:"updated_at",createdProperty:"created_at",uuidProperty:"uuid",momentFormat:"YYYY-MM-DD HH:mm:ss",excludedFolders:[],useKeyupEvents:!1,onlyUpdateExisting:!1,timeout:10,excludeField:"exclude_modified_update",appendField:"append_modified_update",appendMaximumFrequency:"day"},w=class extends n.Plugin{constructor(){super(...arguments);this.timer={}}async onload(){await this.loadSettings(),this.settings.useKeyupEvents?this.settings.useKeyupEvents&&this.registerDomEvent(document,"keyup",t=>{if(!t.ctrlKey&&!t.altKey&&!t.metaKey&&/^.$/u.test(t.key))try{t.target.closest(".markdown-source-view .cm-editor")&&this.updateFrontmatter(t.view.app.workspace.activeEditor.file)}catch(s){}}):this.registerEvent(this.app.workspace.on("editor-change",(t,s)=>{s.file instanceof n.TFile&&this.updateFrontmatter(s.file)})),this.addSettingTab(new b(this.app,this)),this.addCommand({id:"tab-copy-url",name:"Tab-Copy for Advanced URL",callback:()=>{console.log("Tab-Copy for Advanced URL");let t=this.app.vault.getName(),s=this.app.workspace.getActiveFile();s&&this.app.fileManager.processFrontMatter(s,e=>{e[this.settings.uuidProperty]=h();var a=e[this.settings.uuidProperty];let p=s.basename;a||(console.log("uuid\u4E0D\u5B58\u5728,\u65B0\u5EFA\u4E00\u4E2A	"),a=h(),e[this.settings.uuidProperty]=a);let u=`obsidian://advanced-uri?vault=${t}&uid=${a}`;console.log(u);let l=`[${p}](${u} )`;navigator.clipboard.writeText(l)})}})}async loadSettings(){this.settings=Object.assign({},_,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async updateFrontmatter(t){clearTimeout(this.timer[t.path]),this.timer[t.path]=window.setTimeout(()=>{let s=this.app.metadataCache.getFileCache(t);this.settings.onlyUpdateExisting&&!s?.frontmatter?.hasOwnProperty(this.settings.frontmatterProperty)||s?.frontmatter?.[this.settings.excludeField]||this.settings.excludedFolders.some(e=>t.path.startsWith(e+"/"))||this.app.fileManager.processFrontMatter(t,e=>{let a=(0,n.moment)(),p=e[this.settings.appendField]===!0,u=Infinity,l;if(e[this.settings.frontmatterProperty]){let o=e[this.settings.frontmatterProperty];p&&Array.isArray(o)&&(o=o[o.length-1]),l=(0,n.moment)(o,this.settings.momentFormat,!0),l.isValid()&&(u=a.diff(l,"seconds"))}if(u>30){let o=a.format(this.settings.momentFormat);if(p){let d=e[this.settings.frontmatterProperty]||[];Array.isArray(d)||(d=[d]),d.length&&l&&a.isSame(l,this.settings.appendMaximumFrequency)?d[d.length-1]=o:d.push(o),o=d}e[this.settings.frontmatterProperty]=o,e[this.settings.createdProperty]||(e[this.settings.createdProperty]=(0,n.moment)(t.stat.ctime).format(this.settings.momentFormat)),e[this.settings.uuidProperty]||(e[this.settings.uuidProperty]=h()),console.log("\u51C6\u5907\u66F4\u65B0frontmatter"),console.log(e),e.title=t.basename;let v=e.tags;console.log(v),v||(e.tags=[])}})},this.settings.timeout*1e3)}},I=w,b=class extends n.PluginSettingTab{constructor(t,s){super(t,s);this.plugin=s}display(){let{containerEl:t}=this;t.empty(),new n.Setting(t).setName("Frontmatter property for updated time").setDesc("The name of the YAML/frontmatter property to update").addText(s=>s.setPlaceholder("updated_at").setValue(this.plugin.settings.frontmatterProperty).onChange(async e=>{this.plugin.settings.frontmatterProperty=e,await this.plugin.saveSettings()})),new n.Setting(t).setName("Frontmatter property for created time").setDesc("The name of the YAML/frontmatter property to store the created time").addText(s=>s.setPlaceholder("created_at").setValue(this.plugin.settings.createdProperty).onChange(async e=>{this.plugin.settings.createdProperty=e,await this.plugin.saveSettings()})),new n.Setting(t).setName("Frontmatter property for uuid_name").setDesc("The name of the YAML/frontmatter property to store the uuid_name").addText(s=>s.setPlaceholder("uuid_name").setValue(this.plugin.settings.uuidProperty).onChange(async e=>{this.plugin.settings.uuidProperty=e,await this.plugin.saveSettings()})),new n.Setting(t).setName("Date format").setDesc("This is in MomentJS format. Leave blank for the default ATOM format.").addText(s=>s.setPlaceholder("ATOM format").setValue(this.plugin.settings.momentFormat).onChange(async e=>{this.plugin.settings.momentFormat=e,await this.plugin.saveSettings()})),new n.Setting(t).setName("Exclude folders").setDesc("Add a list of folders to exclude, one folder per line. All subfolders will be also excluded.").addTextArea(s=>s.setValue(this.plugin.settings.excludedFolders.join(`
`)).onChange(async e=>{this.plugin.settings.excludedFolders=e.split(`
`).map(a=>a.trim()).filter(a=>!!a),await this.plugin.saveSettings()})),new n.Setting(t).setName("Only update existing fields").setDesc("If you turn this on, it will only update a frontmatter field *if that field already exists*.").addToggle(s=>{s.setValue(this.plugin.settings.onlyUpdateExisting).onChange(async e=>{this.plugin.settings.onlyUpdateExisting=e,await this.plugin.saveSettings()})}),new n.Setting(t).setName("Use typing events instead of Obsidian events").setDesc(`If you make changes to a file using an external editor and Obsidian is currently open, Obsidian
will register this as a modification and update the frontmatter. If you don't want this to happen, and only
want the frontmatter when you are making changes inside Obsidian, you can try this mode. It watches for typing 
events, and then updates the frontmatter only when you type. This means that some events like updating your note 
or properties using your mouse will not cause the modified field to update. You will need to restart Obsidian 
after this change.`).addToggle(s=>{s.setValue(this.plugin.settings.useKeyupEvents).onChange(async e=>{this.plugin.settings.useKeyupEvents=e,await this.plugin.saveSettings()})})}};
